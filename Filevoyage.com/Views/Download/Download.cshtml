@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var filename = ViewBag.Filename as string;
    bool protectQR = (bool)ViewBag.ProtectWithQR;
    int? remaining = ViewBag.Remaining as int?;
    string streamUrl = ViewBag.StreamUrl as string;
    string code = ViewBag.ShortCode as string;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>FileVoyage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="~/css/fv-hero.css" rel="stylesheet" />
</head>
<body>
    <!-- Capa de espera decorativa -->
    <div id="loadingOverlay" class="loading-overlay" aria-hidden="true" aria-live="off"></div>

    <main role="main" id="mainContent" class="fv-hero">
        <div class="fv-overlay"></div>
        <div class="fv-content">
            <div class="fv-card">
                <h1>FileVoyage</h1>
                <p class="fv-sub" aria-label="Nombre de archivo">@filename</p>

                @if (protectQR)
                {
                    <p>Escanea este código QR para descargar el archivo:</p>
                    <img src="@Url.Action("QrCode","Download", new { shortCode = code })"
                         class="fv-qr" alt="Código QR para descargar el archivo" />
                }
                else
                {
                    <p>La descarga comenzará en <span id="countdown" data-target="@streamUrl" aria-live="polite">3</span> segundos. Si no, haz clic:</p>
                    <a href="@streamUrl" class="fv-link" role="button" aria-label="Descargar archivo">Descargar</a>

                    @if (remaining.HasValue)
                    {
                        <p>Quedan <strong>@remaining</strong> descargas</p>
                    }

                    <script>
                        let s = 3,
                            cnt = document.getElementById('countdown'),
                            iv = setInterval(() => {
                                if (--s <= 0) {
                                    clearInterval(iv);
                                    location.href = '@streamUrl';
                                } else {
                                    cnt.textContent = s;
                                }
                            }, 1000);
                    </script>
                }
            </div>
        </div>
    </main>
</body>
</html>

@section Scripts {
    <script src="~/js/download.js" asp-append-version="true"></script>
}